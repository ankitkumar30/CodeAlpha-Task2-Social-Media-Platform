
<!doctype html>
<html>
<head><meta charset="utf-8"><title>Post</title><link rel="stylesheet" href="/styles.css"></head>
<body>
<div class="container">
  <div id="post"></div>
  <h3>Comments</h3>
  <div id="cbox"></div>
  <textarea id="cinput" placeholder="Add comment"></textarea>
  <button onclick="addComment()">Send</button>
</div>
<script src="/shared.js"></script>
<script>
const id=new URLSearchParams(location.search).get('id');
async function load(){
  const p=await (await fetch('/api/posts')).json();
  const me=p.find(x=>x.id==id);
  document.getElementById('post').innerHTML=`<div class="card"><b>${me.author}</b>: ${me.content}</div>`;
  const c=await (await fetch(`/api/posts/${id}/comments`)).json();
  document.getElementById('cbox').innerHTML=c.map(cc=>`<div class="card"><b>${cc.author}</b>: ${cc.content}</div>`).join('');
}
async function addComment(){
  const txt=document.getElementById('cinput').value;
  await fetch(`/api/posts/${id}/comments`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({content:txt})});
  document.getElementById('cinput').value=''; load();
}
load();
</script>
</body>
</html>
